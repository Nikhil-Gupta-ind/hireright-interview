import{r as i,j as t,c as V,S as X,d as ee,e as se,D as oe,a as ae,b as le,f as te,R as K}from"./index-B4okS-fw.js";import{S as ne}from"./icon-arrow-forward-EkO6fcUb.js";import{u as ie,s as ce}from"./session-CrLfDL4Y.js";const de=o=>i.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},i.createElement("path",{d:"M20.25 12H3.75",stroke:"#58240E",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),i.createElement("path",{d:"M10.5 5.25L3.75 12L10.5 18.75",stroke:"#58240E",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})),ue=o=>i.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},i.createElement("path",{d:"M12 12.6L15.9 8.69999C16.0833 8.51665 16.3166 8.42499 16.6 8.42499C16.8833 8.42499 17.1166 8.51665 17.3 8.69999C17.4833 8.88332 17.575 9.11665 17.575 9.39999C17.575 9.68332 17.4833 9.91665 17.3 10.1L12.7 14.7C12.6 14.8 12.4916 14.871 12.375 14.913C12.2583 14.955 12.1333 14.9757 12 14.975C11.8666 14.9743 11.7416 14.9537 11.625 14.913C11.5083 14.8723 11.4 14.8013 11.3 14.7L6.69995 10.1C6.51662 9.91665 6.42495 9.68332 6.42495 9.39999C6.42495 9.11665 6.51662 8.88332 6.69995 8.69999C6.88329 8.51665 7.11662 8.42499 7.39995 8.42499C7.68328 8.42499 7.91662 8.51665 8.09995 8.69999L12 12.6Z",fill:"black",fillOpacity:.4})),fe=o=>i.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},i.createElement("path",{d:"M8 19V5L19 12L8 19ZM10 15.35L15.25 12L10 8.65V15.35Z",fill:"#3637A9"})),me=o=>i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"currentColor",...o},i.createElement("path",{d:"M320-640v320-320Zm-80 400v-480h480v480H240Zm80-80h320v-320H320v320Z"})),pe=({localVideoTrack:o,permissionGranted:e,permissionDenied:n,onRequestPermission:s,videoRef:d,mode:l="setup"})=>{const r=i.useRef(null),a=l==="capture",m=a?701:515,c=a?525:386;return i.useEffect(()=>(o&&r.current&&o.attach(r.current),()=>{o&&o.detach()}),[o]),t.jsx("div",{className:`${a?"lg:h-[525px]":"lg:h-[386px]"} rounded-[24px] relative flex items-center justify-center overflow-hidden select-none bg-black transition-all duration-300 ease-in-out`,style:{aspectRatio:`${m}/${c}`},children:o?t.jsx("video",{ref:p=>{r.current=p,d&&(typeof d=="function"?d(p):d.current=p)},className:"w-full h-full object-cover",style:{width:"100%",height:"100%",transform:"scale(-1, 1)"},muted:!0,playsInline:!0,autoPlay:!0}):t.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center bg-black text-white p-8 text-center",children:!e&&t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"mb-4 font-hanken text-lg",children:"Camera and microphone permission is required"}),t.jsx("button",{onClick:s,className:"bg-white text-black px-4 py-2 rounded-lg font-medium hover:bg-gray-200 transition-colors",children:"Allow microphone and camera"})]})})})},Q=o=>{const e=V.c(32),{selectedOption:n,options:s,className:d,onOptionSelected:l}=o,r=d===void 0?"":d,[a,m]=i.useState(!1),c=i.useRef(null);let p;e[0]!==s.length?(p=()=>{s.length===1&&m(!1)},e[0]=s.length,e[1]=p):p=e[1];let x;e[2]!==s?(x=[s],e[2]=s,e[3]=x):x=e[3],i.useEffect(p,x);let h,k;e[4]!==a?(h=()=>{if(!a)return;const g=P=>{c.current&&!c.current.contains(P.target)&&m(!1)};return document.addEventListener("pointerdown",g),()=>{document.removeEventListener("pointerdown",g)}},k=[a],e[4]=a,e[5]=h,e[6]=k):(h=e[5],k=e[6]),i.useEffect(h,k);const R=`relative ${r}`;let E;e[7]!==a||e[8]!==s.length?(E=()=>s.length>1&&m(!a),e[7]=a,e[8]=s.length,e[9]=E):E=e[9];const A=`flex items-center justify-between bg-[#FAF6F2] px-6 py-4 border border-[#58240E33] cursor-pointer ${a?"rounded-t-[18px] rounded-b-none":"rounded-[18px]"}`;let N;e[10]!==n.label?(N=t.jsx("span",{className:"font-hanken text-[16px] font-medium leading-[22.4px] select-none",children:n.label}),e[10]=n.label,e[11]=N):N=e[11];let I;e[12]!==n.icon||e[13]!==N?(I=t.jsxs("div",{className:"flex gap-6",children:[n.icon,N]}),e[12]=n.icon,e[13]=N,e[14]=I):I=e[14];let y;e[15]!==a||e[16]!==s.length?(y=s.length>1&&t.jsx(ue,{className:`transition-transform ${a?"rotate-180":""}`}),e[15]=a,e[16]=s.length,e[17]=y):y=e[17];let L;e[18]!==I||e[19]!==y||e[20]!==E||e[21]!==A?(L=t.jsxs("div",{onClick:E,className:A,children:[I,y]}),e[18]=I,e[19]=y,e[20]=E,e[21]=A,e[22]=L):L=e[22];let C;e[23]!==a||e[24]!==l||e[25]!==s||e[26]!==n.label?(C=a&&t.jsx("div",{className:"absolute top-full bg-[#FAF6F2CC] border border-[#58240E33] rounded-b-[18px] w-full z-10 border-t-0 backdrop-blur-[10px]",children:s.filter(g=>g.label!==n.label).map((g,P)=>t.jsx("div",{onClick:()=>{l(g),m(!1)},className:"px-6 py-3 hover:bg-[#EFDFD3] cursor-pointer last:rounded-b-[18px] border-b border-[#58240E33] last:border-b-0",children:t.jsxs("div",{className:"flex gap-6",children:[g.icon,t.jsx("span",{className:"font-hanken text-[16px] font-medium leading-[22.4px] select-none",children:g.label})]})},P))}),e[23]=a,e[24]=l,e[25]=s,e[26]=n.label,e[27]=C):C=e[27];let F;return e[28]!==L||e[29]!==C||e[30]!==R?(F=t.jsxs("div",{ref:c,className:R,children:[L,C]}),e[28]=L,e[29]=C,e[30]=R,e[31]=F):F=e[31],F},xe=o=>{const e=V.c(11),{onBack:n,mode:s}=o,l=(s===void 0?"setup":s)==="capture";let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsx(de,{}),e[0]=r):r=e[0];let a;e[1]!==n?(a=t.jsx("button",{className:"absolute left-0 p-2.5 active:scale-95 transition-transform duration-150 ease-in-out z-10 rounded-full hover:bg-[#EFDFD3]",onClick:n,children:r}),e[1]=n,e[2]=a):a=e[2];const m=l?"Capture your Photo":"Let’s get set up!";let c;e[3]!==m?(c=t.jsx("h1",{className:"heading-primary",children:m}),e[3]=m,e[4]=c):c=e[4];const p=l?"This image will be used to verify your identity throughout the interview process to ensure integrity":"Check if all your audio and video are set up, and let’s get started";let x;e[5]!==p?(x=t.jsx("p",{className:"text-[rgba(12,12,14,0.80)] font-hanken text-[20px] font-normal leading-[140%] tracking-[-0.2px] mt-3",children:p}),e[5]=p,e[6]=x):x=e[6];let h;return e[7]!==a||e[8]!==c||e[9]!==x?(h=t.jsxs("div",{className:"relative flex flex-col items-center text-center",children:[a,c,x]}),e[7]=a,e[8]=c,e[9]=x,e[10]=h):h=e[10],h},he=12,ve=4,ge=o=>{const e=V.c(41),{track:n,trackVersion:s,className:d}=o,l=d===void 0?"":d,r=i.useRef(null),[a,m]=i.useState(0),[c,p]=i.useState(!1),[x,h]=i.useState(0),[k,R]=i.useState("Status");i.useRef(null),i.useRef(null),i.useRef(null),i.useRef(0);let E,A;e[0]===Symbol.for("react.memo_cache_sentinel")?(E=()=>{const G=()=>{if(!r.current)return;const f=r.current.offsetWidth;m(Math.floor(f/(he+ve)))};G();const D=new ResizeObserver(G);return D.observe(r.current),()=>D.disconnect()},A=[],e[0]=E,e[1]=A):(E=e[0],A=e[1]),i.useEffect(E,A);let N;e[2]!==a||e[3]!==c||e[4]!==n?(N=()=>{if(!c||!n||!n.mediaStreamTrack){h(0);return}const G=window.AudioContext||window.webkitAudioContext,D=new G,f=D.createMediaStreamSource(new MediaStream([n.mediaStreamTrack])),u=D.createAnalyser();u.fftSize=32,f.connect(u);const v=new Uint8Array(u.frequencyBinCount);let M;const S=()=>{u.getByteFrequencyData(v);let q=0;const U=v.length;for(let J=0;J<U;J++)q=q+v[J];const b=q/U,j=Math.min(a,Math.floor(b/100*a));h(j),b>50?R("Perfect"):b>10&&R("Low"),M=requestAnimationFrame(S)};return S(),()=>{cancelAnimationFrame(M),f.disconnect(),u.disconnect(),D.close()}},e[2]=a,e[3]=c,e[4]=n,e[5]=N):N=e[5];let I;e[6]!==a||e[7]!==c||e[8]!==s?(I=[c,s,a],e[6]=a,e[7]=c,e[8]=s,e[9]=I):I=e[9],i.useEffect(N,I);let y;e[10]!==c?(y=()=>{p(!c),c||R("Status")},e[10]=c,e[11]=y):y=e[11];const L=y,C=`flex flex-row gap-3 ${l}`,F=`text-white flex gap-2.5 py-4 pl-4.5 pr-6 ${c?"bg-[#3637A9]":"bg-[#E0E1F9]"} border border-[#3637A9] rounded-tl-[56px] rounded-bl-[56px] rounded-tr-[18px] rounded-br-[18px] items-center hover:brightness-95 shrink-0 min-w-28`;let g;e[12]!==c?(g=c?t.jsx(me,{}):t.jsx(fe,{}),e[12]=c,e[13]=g):g=e[13];const P=`${c?"text-white":"text-[#3637A9]"} font-hanken text-[16px] font-medium leading-[22.4px]`,W=c?"Stop":"Test";let O;e[14]!==P||e[15]!==W?(O=t.jsx("span",{className:P,children:W}),e[14]=P,e[15]=W,e[16]=O):O=e[16];let $;e[17]!==L||e[18]!==O||e[19]!==F||e[20]!==g?($=t.jsxs("button",{onClick:L,className:F,children:[g,O]}),e[17]=L,e[18]=O,e[19]=F,e[20]=g,e[21]=$):$=e[21];let T;e[22]!==a?(T=Array.from({length:a}),e[22]=a,e[23]=T):T=e[23];let B;e[24]!==T||e[25]!==x?(B=t.jsx("div",{ref:r,className:"flex gap-1 flex-1",children:T.map((G,D)=>t.jsx("div",{className:`w-3 h-8 rounded-sm ${D<x?"bg-[#6466EA]":"bg-[#6466EA33]"}`},D))}),e[24]=T,e[25]=x,e[26]=B):B=e[26];const Y=`w-5 h-5 rounded-full ${k==="Perfect"?"bg-[#17A012]":"bg-[#9CA3AF]"}`;let z;e[27]!==Y?(z=t.jsx("span",{className:Y}),e[27]=Y,e[28]=z):z=e[28];let H;e[29]!==k?(H=t.jsx("span",{className:"font-hanken text-[16px] font-medium leading-[22.4px]",children:k}),e[29]=k,e[30]=H):H=e[30];let w;e[31]!==z||e[32]!==H?(w=t.jsxs("div",{className:"flex gap-2 ml-4 shrink-0",children:[z,H]}),e[31]=z,e[32]=H,e[33]=w):w=e[33];let _;e[34]!==B||e[35]!==w?(_=t.jsxs("div",{className:"flex items-center bg-[#F8F2ED5C] rounded-2xl border border-[#58240E33] px-4 py-4 flex-1 min-w-0",children:[B,w]}),e[34]=B,e[35]=w,e[36]=_):_=e[36];let Z;return e[37]!==$||e[38]!==_||e[39]!==C?(Z=t.jsxs("div",{className:C,children:[$,_]}),e[37]=$,e[38]=_,e[39]=C,e[40]=Z):Z=e[40],Z},re=o=>{const e=V.c(7);let n,s;e[0]!==o?({className:s,...n}=o,e[0]=o,e[1]=n,e[2]=s):(n=e[1],s=e[2]);const d=s===void 0?"w-5 h-5":s;let l;e[3]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx("path",{d:"M17.71 7.71L12 2h-1v7.59L6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 11 14.41V22h1l5.71-5.71-4.3-4.29 4.3-4.29zM13 5.83l1.88 1.88L13 9.59V5.83zm1.88 10.46L13 18.17v-3.76l1.88 1.88z"}),e[3]=l):l=e[3];let r;return e[4]!==d||e[5]!==n?(r=t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:d,...n,children:l}),e[4]=d,e[5]=n,e[6]=r):r=e[6],r},we=o=>{const e=V.c(7);let n,s;e[0]!==o?({className:s,...n}=o,e[0]=o,e[1]=n,e[2]=s):(n=e[1],s=e[2]);const d=s===void 0?"w-5 h-5":s;let l;e[3]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx("path",{d:"M12 1a9 9 0 0 0-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h3c1.66 0 3-1.34 3-3v-7a9 9 0 0 0-9-9z"}),e[3]=l):l=e[3];let r;return e[4]!==d||e[5]!==n?(r=t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:d,...n,children:l}),e[4]=d,e[5]=n,e[6]=r):r=e[6],r},be=o=>{const e=V.c(7);let n,s;e[0]!==o?({className:s,...n}=o,e[0]=o,e[1]=n,e[2]=s):(n=e[1],s=e[2]);const d=s===void 0?"w-5 h-5":s;let l;e[3]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx("path",{d:"M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 0 0-1.01.24l-2.2 2.2a15.161 15.161 0 0 1-6.59-6.59l2.2-2.21c.28-.26.36-.65.25-1.01A11.36 11.36 0 0 1 8.5 4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1 15.12 15.12 0 0 0 16 16c.55 0 1-.45 1-1v-3.5c0-.55-.45-1-1-1zM12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),e[3]=l):l=e[3];let r;return e[4]!==d||e[5]!==n?(r=t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:d,...n,children:l}),e[4]=d,e[5]=n,e[6]=r):r=e[6],r};function je(o){if(!o||!o.label)return ee;const e=o.label.toLowerCase();return e.includes("bluetooth")||e.includes("airpods")||e.includes("buds")||e.includes("wireless")||e.includes("wh-")||e.includes("wf-")?re:e.includes("headphone")||e.includes("headset")||e.includes("usb")||e.includes("wired")?we:e.includes("earpiece")||e.includes("internal")||e.includes("phone")?be:ee}function ke(o){if(!o||!o.label)return X;const e=o.label.toLowerCase();return e.includes("bluetooth")||e.includes("airpods")||e.includes("buds")?re:X}const ye=o=>{const e=V.c(6),{onTakePhoto:n}=o;let s;e[0]===Symbol.for("react.memo_cache_sentinel")?(s=["Center your face","Ensure good lighting","Remove face coverings/hats","Look directly at the camera"],e[0]=s):s=e[0];const d=s;let l;e[1]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx("h3",{className:"text-[20px] font-semibold text-(--color-text-primary) tracking-[-1px] font-hanken leading-[120%]",children:"Guidelines"}),e[1]=l):l=e[1];let r;e[2]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsx("div",{className:"flex-1 space-y-0",children:d.map(Se)}),e[2]=r):r=e[2];let a;e[3]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(se,{className:"w-6 h-6"}),e[3]=a):a=e[3];let m;return e[4]!==n?(m=t.jsxs("div",{className:"flex flex-col w-full items-start gap-5",children:[l,r,t.jsxs("button",{onClick:n,className:"w-full bg-(--color-primary) rounded-[18px] flex items-center justify-center gap-3 text-white font-hanken font-semibold text-[16px] tracking-[-0.2px] leading-[140%] hover:brightness-90 active:scale-98 transition-all duration-150 ease-in-out select-none mt-auto px-6 py-4",children:[a,"Take Photo"]})]}),e[4]=n,e[5]=m):m=e[5],m};function Se(o,e){return t.jsx("div",{className:"flex items-start gap-3",children:t.jsx("p",{className:"text-[20px] text-[#0C0C0ECC] font-hanken font-normal leading-[140%] tracking-[-0.2px]",children:`${e+1}. ${o}`})},e)}const Ne=o=>{const e=V.c(19),{photoUrl:n,onRetake:s,onStartInterview:d,isLoading:l}=o;let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsx("h3",{className:"text-(--color-text-primary) font-hanken text-[20px] font-semibold leading-[120%] tracking-[-1px] mb-[28px]",children:"Your Photo Preview"}),e[0]=r):r=e[0];let a;e[1]===Symbol.for("react.memo_cache_sentinel")?(a={aspectRatio:"427/235",transform:"scale(-1, 1)"},e[1]=a):a=e[1];let m;e[2]!==n?(m=t.jsx("div",{className:"flex-1 rounded-[12px] relative flex items-center justify-center overflow-hidden select-none bg-black overflow-clip",children:t.jsx("img",{src:n,alt:"Captured",className:"w-full h-full object-cover",style:a})}),e[2]=n,e[3]=m):m=e[3];let c;e[4]!==l?(c=l?t.jsx(oe,{}):t.jsxs(t.Fragment,{children:["Start Interview",t.jsx(ne,{className:"transition-transform duration-300 group-hover:translate-x-1"})]}),e[4]=l,e[5]=c):c=e[5];let p;e[6]!==l||e[7]!==d||e[8]!==c?(p=t.jsx("button",{onClick:d,disabled:l,className:"group w-full h-[56px] flex gap-[12px] text-white bg-(--color-primary) border border-(--color-primary) pl-[24px] pr-[20px] py-[16px] rounded-[18px] items-center justify-center hover:brightness-90 active:scale-95 transition-all duration-150 ease-in-out select-none disabled:cursor-not-allowed disabled:opacity-70 font-hanken font-semibold text-[16px] tracking-[-0.2px]",children:c}),e[6]=l,e[7]=d,e[8]=c,e[9]=p):p=e[9];let x;e[10]!==l||e[11]!==s?(x=t.jsx("button",{onClick:s,disabled:l,className:"w-full h-[56px] flex items-center justify-center text-(--color-primary) bg-transparent border border-(--color-primary) rounded-[100px] hover:bg-(--color-primary)/5 active:scale-95 transition-all duration-150 ease-in-out select-none font-hanken font-semibold text-[16px] tracking-[-0.2px]",children:"Retake"}),e[10]=l,e[11]=s,e[12]=x):x=e[12];let h;e[13]!==p||e[14]!==x?(h=t.jsxs("div",{className:"w-[427px] flex flex-col gap-[16px] mt-[78px]",children:[p,x]}),e[13]=p,e[14]=x,e[15]=h):h=e[15];let k;return e[16]!==m||e[17]!==h?(k=t.jsxs("div",{className:"flex flex-col h-full",children:[r,t.jsxs("div",{className:"flex-1 flex flex-col items-start gap-0",children:[m,h]})]}),e[16]=m,e[17]=h,e[18]=k):k=e[18],k},Le=()=>{const o=ae(),{sessionData:e,selectedCompanion:n,selectedDevices:s,setSelectedDevices:d}=le(),l=e?.sessionCode,[r,a]=i.useState("setup"),[m,c]=i.useState(null),p=i.useRef(null),x=()=>{r==="capture"?window.history.back():o(-1)},h=()=>o("/interview"),k=()=>{a("capture"),window.history.pushState({mode:"capture"},"")};i.useEffect(()=>{const f=u=>{r==="capture"&&(a("setup"),c(null))};return window.addEventListener("popstate",f),()=>window.removeEventListener("popstate",f)},[r]);const R=()=>{if(p.current){const f=p.current,u=document.createElement("canvas");u.width=f.videoWidth,u.height=f.videoHeight;const v=u.getContext("2d");v.translate(u.width,0),v.scale(-1,1),v.drawImage(f,0,0,u.width,u.height),u.toBlob(M=>{c(M)},"image/jpeg")}},[E,A]=i.useState(!1),[N,I]=i.useState(null),[y,L]=i.useState(null),[C,F]=i.useState(!1),[g,P]=i.useState(!1),[W,O]=i.useState(0),[$,T]=i.useState([s.mic]),[B,Y]=i.useState([s.speaker]),[z,H]=i.useState([s.camera]),w=i.useRef([]),_=async(f=!0)=>{try{const u=await K.getLocalDevices("audioinput"),v=await K.getLocalDevices("audiooutput"),M=await K.getLocalDevices("videoinput");if(f){const S=u.map(b=>{const j=ke(b);return{icon:t.jsx(j,{}),label:b.label,deviceId:b.deviceId}}),q=v.map(b=>{const j=je(b);return{icon:t.jsx(j,{}),label:b.label,deviceId:b.deviceId}}),U=M.map(b=>({icon:t.jsx(se,{}),label:b.label,deviceId:b.deviceId}));T(S),Y(q),H(U),S.length>0&&(s.mic&&S.find(j=>j.deviceId===s.mic.deviceId)||d(j=>({...j,mic:S[0]}))),q.length>0&&(s.speaker&&q.find(j=>j.deviceId===s.speaker.deviceId)||d(j=>({...j,speaker:q[0]}))),U.length>0&&(s.camera&&U.find(j=>j.deviceId===s.camera.deviceId)||d(j=>({...j,camera:U[0]})))}}catch(u){console.error("Failed to fetch devices",u)}},Z=async(f=!0)=>{try{const u=await te({audio:d.mic?.deviceId?{deviceId:{exact:d.mic.deviceId}}:!0,video:!0});if(!f){u.forEach(S=>S.stop());return}w.current.forEach(S=>{S.stop&&S.stop()}),w.current=[],w.current=u,F(!0),P(!1);const v=u.find(S=>S.kind==="video"),M=u.find(S=>S.kind==="audio");v&&I(v),M&&L(M),await _(f)}catch(u){console.error("Failed to acquire tracks:",u),P(!0)}};i.useEffect(()=>{let f=!0;Z(f);const u=()=>{_(f)};return navigator.mediaDevices.addEventListener("devicechange",u),()=>{f=!1,navigator.mediaDevices.removeEventListener("devicechange",u),w.current.forEach(v=>{v.stop()}),w.current=[]}},[]);const G=()=>{Z(!0)},D=async()=>{if(!l||!n){console.error("Missing session Code or selected companion");return}if(!m){alert("Please capture a photo first.");return}A(!0);try{await ie(l,m),await ce(l,n.id),w.current.forEach(f=>f.stop()),w.current=[],h()}catch(f){console.error("Failed to start session:",f),alert(f.message||"Failed to start session. Please try again.")}finally{A(!1)}};return i.useEffect(()=>{console.log(y?.mediaStreamTrack.getSettings().deviceId)},[W]),t.jsxs("div",{className:"min-h-screen bg-(--color-bg) px-4 py-6 sm:p-8 lg:p-16 relative flex flex-col",children:[t.jsx(xe,{onBack:x,mode:r}),t.jsx("div",{className:"flex-1 flex items-center justify-center lg:-translate-y-10",children:t.jsxs("div",{className:`flex flex-col lg:flex-row w-full max-w-6xl 
          ${r==="setup"?"gap-6 lg:gap-16.75":"gap-0 lg:gap-[32px]"} 
          items-center lg:items-start`,children:[t.jsx("div",{className:"flex-none flex flex-col items-center justify-center",children:t.jsx(pe,{localVideoTrack:N,permissionGranted:C,permissionDenied:g,onRequestPermission:G,videoRef:p,mode:r})}),t.jsxs("div",{className:`flex-1 ${C?"":"opacity-50 pointer-events-none grayscale"}`,children:[r==="setup"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative",children:[!C&&t.jsx("div",{className:"absolute -top-10 left-0 text-sm font-medium text-[#5B3823]",children:"Permission needed"}),s.mic&&t.jsx(Q,{selectedOption:s.mic,options:$,onOptionSelected:async f=>{d(v=>({...v,mic:f})),y&&(y.stop(),w.current=w.current.filter(v=>v.kind!=="audio"));const[u]=await te({audio:{deviceId:{exact:f.deviceId}},video:!1});w.current.push(u),L(u),O(v=>v+1)}})]}),s.speaker&&t.jsx(Q,{selectedOption:s.speaker,options:B,className:"mt-4.5",onOptionSelected:f=>{d(u=>({...u,speaker:f}))}}),t.jsx(ge,{className:"mt-4.5 select-none",track:y,trackVersion:W,speakerDeviceId:s.speaker?.deviceId}),s.camera&&t.jsx(Q,{selectedOption:s.camera,options:z,className:"mt-6.5",onOptionSelected:async f=>{if(d(u=>({...u,camera:f})),N)try{await N.restartTrack({deviceId:f.deviceId})}catch(u){console.error("Failed to switch camera",u)}}}),t.jsxs("button",{onClick:k,disabled:E||!C,className:"group flex gap-3 text-white bg-(--color-primary) px-6 py-4 rounded-[18px] mt-6 items-center hover:brightness-90 active:scale-95 transition-transform duration-150 ease-in-out select-none disabled:cursor-not-allowed justify-center",children:["Next",t.jsx(ne,{className:"transition-transform duration-300 group-hover:translate-x-1"})]})]}),r==="capture"&&!m&&t.jsx(ye,{onTakePhoto:R}),r==="capture"&&m&&t.jsx(Ne,{photoUrl:URL.createObjectURL(m),onRetake:R,onStartInterview:D,isLoading:E})]})]})})]})};export{Le as default};
